

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Mürüvvet BOZKURT &mdash; ITUCSDB1942 2019 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Parts Implemented by Neslihan ÇEKİÇ" href="neslihan.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1942
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="neslihan.html">Parts Implemented by Neslihan ÇEKİÇ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Parts Implemented by Mürüvvet BOZKURT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creation-of-tables">Creation of Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-book-operations">Basic Book Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#book-sort-operations">Book Sort Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#book-comment-operations">Book Comment Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#book-list-operations">Book List Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-book-page-operations">Add Book Page Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#login-page-operations">Login Page Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#account-operations">Account Operations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1942</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Mürüvvet BOZKURT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/muruvvet.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-muruvvet-bozkurt">
<h1>Parts Implemented by Mürüvvet BOZKURT<a class="headerlink" href="#parts-implemented-by-muruvvet-bozkurt" title="Permalink to this headline">¶</a></h1>
<p>This page will be providing information on
* <em>Creation of Tables</em>
* <em>Basic Book Operations</em>
* <em>Book Sort Operations *
* *Book Comment Operations</em>
* <em>Book List Operations</em>
* <em>Add Book Page Operations</em>
* <em>Login Page Operations</em>
* <em>Account Operations</em></p>
<div class="section" id="creation-of-tables">
<h2>Creation of Tables<a class="headerlink" href="#creation-of-tables" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dbmur.png"><img alt="Database implemented by Mürüvvet" src="../_images/dbmur.png" style="width: 953.0999999999999px; height: 898.5px;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All table creations exist in dbinit.py file.</p>
</div>
<p>Firstly, I thought of all the tables I would use and created them. There are 3 main tables and 2 extra tables for books. My main tables are “books”, “book_list”, “comment_b” and my extra tables are “Writer” and “Book_trace”. I do not need the “Writer” table, but I did not delete it because it would be hard to make changes because I started writing the code. The reason for “on delete cascade” addition will be explained in the account.py</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">writer</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">wr_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">wr_country</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);,</span>

  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">books</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">NAME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">WRITERID</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">writer</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">PUB_YEAR</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">T_PAGE</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">PUBLISHER</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="k">LANGUAGE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">GENRE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">SCORE</span> <span class="n">SCORES</span><span class="p">,</span>
    <span class="n">VOTE</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">);,</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">book_list</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">userid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">bookid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">books</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">fav_b</span> <span class="n">BOOL</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">hate_b</span> <span class="n">BOOL</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">wish_b</span> <span class="n">BOOL</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">readed</span> <span class="n">BOOL</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">reading</span> <span class="n">BOOL</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="k">UNIQUE</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="n">bookid</span><span class="p">)</span>
<span class="p">);,</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">book_trace</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">userid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">bookid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">books</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">readpage</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="k">UNIQUE</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">bookid</span><span class="p">)</span>
<span class="p">);,</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">comment_b</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">userid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">bookid</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">books</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="n">headerb</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">contentb</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">),</span>
    <span class="n">likeb</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dislikeb</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nb">date</span> <span class="k">TIMESTAMP</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-book-operations">
<h2>Basic Book Operations<a class="headerlink" href="#basic-book-operations" title="Permalink to this headline">¶</a></h2>
<p>Basic book operations contain functions for printing information of the one book(dynamic page), deleting books, checking progress, updating page number that user read and rating operations.</p>
<p>The books.py file was first created for the database operations of the book page. In this file, a class named “Book” has been created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Book</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_pub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tpage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">genre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">publisher</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">vote</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">score</span><span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">=</span> <span class="n">writer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">year_pub</span><span class="o">=</span> <span class="n">year_pub</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tpage</span><span class="o">=</span> <span class="n">tpage</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genre</span><span class="o">=</span> <span class="n">genre</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">=</span> <span class="n">publisher</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="o">=</span> <span class="n">language</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vote</span><span class="o">=</span><span class="n">vote</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="o">=</span><span class="n">score</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Printing Information of The One Book</em></p></li>
</ul>
<hr class="docutils" />
<p>This function returns one book. It provide us to print information of the book in dynamic page.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_book</span><span class="p">(</span><span class="n">idno</span><span class="p">):</span>

        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT books.ID, books.NAME, writer.wr_name, books.PUB_YEAR, books.T_PAGE, books.PUBLISHER,</span>
<span class="s2">        books.LANGUAGE, books.GENRE, books.SCORE, books.VOTE FROM BOOKS, writer WHERE books.id=</span><span class="si">%s</span><span class="s2"> AND books.writerid=writer.id;                 &quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">idno</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wri_name</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">pub</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span><span class="n">Book</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">wri_name</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">page</span><span class="p">,</span><span class="n">gprint_commit_booken</span><span class="p">,</span><span class="n">pub</span><span class="p">,</span><span class="n">lang</span><span class="p">,</span><span class="n">vote</span><span class="p">,</span><span class="n">sc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">book</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Updating Page Number</em></p></li>
</ul>
<hr class="docutils" />
<blockquote>
<div><p>The user can update the number of pages read with this function. The userid and bookid are unique because a book cannot be in the read list, read list, read list at the same time. If you take “UniqueViolation error, you update the number of pages of that book instead of inserting the same book to trace.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">updatepage</span><span class="p">(</span><span class="n">bookid</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO book_trace (userid, bookid, readpage)</span>
<span class="s2">                    VALUES ( </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                RETURNING id;&quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">userid</span><span class="p">,</span><span class="n">bookid</span><span class="p">,</span><span class="n">page</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; UPDATE book_trace</span>
<span class="s2">                    SET readpage = </span><span class="si">%s</span><span class="s2"> WHERE userid = </span><span class="si">%s</span><span class="s2"> AND bookid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">bookid</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">InFailedSqlTransactions</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Checking Progress</em></p></li>
</ul>
<hr class="docutils" />
<p>This code does not allow entering a page number greater than the total page of the book.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_tpage</span><span class="p">(</span><span class="n">readed</span><span class="p">,</span><span class="n">bookid</span><span class="p">,</span><span class="n">userid</span><span class="p">):</span>

                <span class="n">statement</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;SELECT t_page FROM books WHERE id= (</span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">bookid</span><span class="p">,))</span>
                <span class="n">tpage</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">readed</span><span class="o">&gt;</span><span class="n">tpage</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Rate Book</em></p></li>
</ul>
<hr class="docutils" />
<p>This code will update the book’s score and the number of times the book is rated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_score</span><span class="p">(</span><span class="n">bookid</span><span class="p">,</span><span class="n">score</span><span class="p">):</span>
<span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; UPDATE books</span>
<span class="s2">                            SET SCORE = (SCORE*VOTE+</span><span class="si">%s</span><span class="s2">)/(VOTE+1),VOTE=VOTE+1 WHERE id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">bookid</span><span class="p">,))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Delete books</em></p></li>
</ul>
<hr class="docutils" />
<p>Only admin user can delete books. Since many tables are connected to userid and bookid, variables are defined in tables as cascading where necessary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_book</span><span class="p">(</span><span class="n">idno</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                      <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;DELETE FROM books WHERE id=</span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
                      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">idno</span><span class="p">,))</span>
                      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
  <span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
      <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="book-sort-operations">
<h2>Book Sort Operations<a class="headerlink" href="#book-sort-operations" title="Permalink to this headline">¶</a></h2>
<p>The bookpage web page was created in the server.py file, and it was determined which sort order according to its extension. When clicking on “books”, the post method was used to redirect to its web page.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/bookpage/&lt;string:sort&gt;&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
    <span class="nd">@login_required</span>
    <span class="k">def</span> <span class="nf">bookpage</span><span class="p">(</span><span class="n">sort</span><span class="p">):</span>
            <span class="n">book_list</span><span class="o">=</span><span class="n">print_book</span><span class="p">()</span> <span class="c1"># BÜTÜN BOOK OBJELERİNİN ARRRAYİ</span>
            <span class="k">if</span> <span class="n">sort</span><span class="o">==</span><span class="s2">&quot;sortbyaz&quot;</span><span class="p">:</span>
                    <span class="n">books</span><span class="o">=</span><span class="n">print_book_by_az</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">sort</span><span class="o">==</span><span class="s2">&quot;sortbyscore&quot;</span><span class="p">:</span>
                    <span class="n">books</span><span class="o">=</span><span class="n">print_book_by_score</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">sort</span><span class="o">==</span><span class="s2">&quot;sortbyyear&quot;</span><span class="p">:</span>
                    <span class="n">books</span><span class="o">=</span><span class="n">print_book_by_year</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">sort</span><span class="o">==</span><span class="s2">&quot;sortbydefault&quot;</span><span class="p">:</span>
                    <span class="n">books</span><span class="o">=</span><span class="n">print_book</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;form_id&#39;</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">,</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                    <span class="n">readed</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">])</span>
                     <span class="n">bookid</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;bookid&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">check_tpage</span><span class="p">(</span><span class="n">readed</span><span class="p">,</span><span class="n">bookid</span><span class="p">,</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                            <span class="n">updatepage</span><span class="p">(</span><span class="n">bookid</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">readed</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                            <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid Page Number!&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;bookpage.html&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">=</span><span class="n">books</span><span class="p">)</span> <span class="c1">#book listi book adındA HTML E GÖNDERİYOR.</span>
</pre></div>
</div>
<p>These are the functions that determine the order in which books are printed on the book page.</p>
<ul class="simple">
<li><p><em>Print Default &amp; A-Z &amp; Year &amp; Score</em></p></li>
</ul>
<hr class="docutils" />
<p>These functions sort by book id, alphabetical order, year, score. The only difference between functions is the “ORDER BY…” part. Book_list is a tuble that contains all books. We add each book in our database to this tuple. In fact,  tuple is printed on the screen.</p>
<p>For Example:</p>
<p>Print Default</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_book</span><span class="p">():</span>
           <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
               <span class="n">book_list</span><span class="o">=</span><span class="p">[]</span>
               <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT books.ID, books.NAME, writer.wr_name, books.PUB_YEAR, books.T_PAGE, books.PUBLISHER,</span>
<span class="s2">               books.LANGUAGE, books.GENRE, books.SCORE, books.VOTE FROM BOOKS, writer WHERE books.writerid=writer.id ORDER BY id; &quot;&quot;&quot;</span>
               <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
               <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wr_name</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">pub</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                       <span class="n">book</span> <span class="o">=</span><span class="n">Book</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">wr_name</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">page</span><span class="p">,</span><span class="n">gen</span><span class="p">,</span><span class="n">pub</span><span class="p">,</span><span class="n">lang</span><span class="p">,</span><span class="n">vote</span><span class="p">,</span><span class="n">sc</span><span class="p">)</span>
                       <span class="n">book_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
               <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
               <span class="k">return</span> <span class="n">book_list</span>
</pre></div>
</div>
</div>
<div class="section" id="book-comment-operations">
<h2>Book Comment Operations<a class="headerlink" href="#book-comment-operations" title="Permalink to this headline">¶</a></h2>
<p>For comments, a class named commitb was created in books.py.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">commitb</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bookid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">content</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">like</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dislike</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="o">=</span><span class="n">username</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bookid</span><span class="o">=</span><span class="n">bookid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">=</span><span class="n">header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">=</span><span class="n">content</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">=</span><span class="n">date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">like</span><span class="o">=</span><span class="n">like</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dislike</span><span class="o">=</span><span class="n">dislike</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Inserting</em></p></li>
</ul>
<hr class="docutils" />
<p>You add a new row to the comment table by adding a comment. Datetime.now provides that get the current date and time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">submit_commit_book</span><span class="p">(</span><span class="n">bookid</span><span class="p">,</span><span class="n">userid</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">context</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO comment_b (userid, bookid, headerb, contentb,date)</span>
<span class="s2">                                    VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                                RETURNING id;&quot;&quot;&quot;</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">userid</span><span class="p">,</span><span class="n">bookid</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">context</span><span class="p">,</span><span class="n">now</span><span class="p">))</span>
                        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Deleting</em></p></li>
</ul>
<hr class="docutils" />
<p>I enabled the user to delete only his / her comment by sending userid.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span>  <span class="nf">delete_commitb</span><span class="p">(</span><span class="n">idno</span><span class="p">,</span> <span class="n">userid</span><span class="p">):</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; DELETE FROM comment_b</span>
<span class="s2">                            WHERE userid = </span><span class="si">%s</span><span class="s2"> AND id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span> <span class="n">userid</span><span class="p">,</span> <span class="n">idno</span><span class="p">,))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Updating and Reading Like &amp; Dislike</em></p></li>
</ul>
<hr class="docutils" />
<p>We send form to html and if like button is pressed it increases the number of likes by one. A user may like or dislike same comment more than once.To prevent this, I had to keep the userid, but it is not necessary, so I did not it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">com_like_book</span><span class="p">(</span><span class="n">commitid</span><span class="p">):</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; UPDATE comment_b</span>
<span class="s2">                SET likeb= likeb+1 WHERE id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span> <span class="n">commitid</span><span class="p">,))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>For reading numbers of like and dislike;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">com_dislike_numberb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; SELECT dislikeb FROM comment_b</span>
<span class="s2">                    WHERE  id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
        <span class="n">dislike_n</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dislike_n</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Reading</em></p></li>
</ul>
<hr class="docutils" />
<p>I added all comments to the commit list and returned the commit list. So I wrote the required function to print all comments on the screen.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_commit_book</span><span class="p">(</span><span class="n">bookid</span><span class="p">):</span>
    <span class="n">commits</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT comment_b.id, comment_b.headerb,comment_b.contentb,comment_b.date, users.username FROM comment_b,users</span>
<span class="s2">                                     WHERE comment_b.bookid=(</span><span class="si">%s</span><span class="s2">) AND comment_b.userid=users.id ORDER BY date DESC;&quot;&quot;&quot;</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">bookid</span><span class="p">,))</span>
                        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">head</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">username</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                            <span class="n">com</span><span class="o">=</span><span class="n">commitb</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span><span class="n">bookid</span><span class="o">=</span><span class="n">bookid</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">head</span><span class="p">,</span><span class="n">content</span><span class="o">=</span><span class="n">cont</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
                            <span class="n">commits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">com</span><span class="p">)</span>

                        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">commits</span>
</pre></div>
</div>
</div>
<div class="section" id="book-list-operations">
<h2>Book List Operations<a class="headerlink" href="#book-list-operations" title="Permalink to this headline">¶</a></h2>
<p>List operations consist of create, update, read operations.The values ​​stored in the list are in bool.
When we want to remove a book from a list, we can not delete it. Because the deletion is done row by row and then the book is deleted from the other lists.
In order to avoid this situation, I am just updating the table that user wants to add or remove.</p>
<ul class="simple">
<li><p><em>Automatically Add to Some Lists</em></p></li>
</ul>
<hr class="docutils" />
<p>This function provide to add automatically to Read, Unread, reading list as percent progress of book.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">book_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">userid</span><span class="p">):</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">checkreaded</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">statement</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;SELECT readpage FROM book_trace WHERE bookid= (</span><span class="si">%s</span><span class="s2">) AND userid=(</span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">userid</span><span class="p">,))</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                    <span class="n">checkreaded</span><span class="o">=</span><span class="n">p</span>
                <span class="k">if</span><span class="p">(</span><span class="n">checkreaded</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">per</span><span class="o">=</span><span class="n">checkreaded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">percent</span><span class="o">=</span><span class="n">per</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tpage</span>
                <span class="k">if</span><span class="p">(</span><span class="n">percent</span><span class="o">==</span><span class="mf">100.0</span><span class="p">):</span>
                    <span class="n">readed_add</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">percent</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">reading_add</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">percent</span><span class="o">==</span><span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">notread_add</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">percent</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Checking Lists</em></p></li>
</ul>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_hate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">userid</span><span class="p">):</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; SELECT hate_b FROM book_list</span>
<span class="s2">                            WHERE userid = </span><span class="si">%s</span><span class="s2"> AND bookid = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span> <span class="n">userid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">check</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">check</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Reading Lists</em></p></li>
</ul>
<hr class="docutils" />
<p>There are separate “read” functions for all tables in “book_trace”. They all have the same structure. I’ve just changed which table to do. So here’s just one example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">print_readed</span><span class="p">(</span><span class="n">idno</span><span class="p">):</span>
<span class="n">books</span><span class="o">=</span><span class="p">{}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                            <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT book_list.bookid, books.name FROM book_list,books</span>
<span class="s2">                                         WHERE book_list.readed=TRUE AND book_list.bookid=books.id AND userid=</span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">idno</span><span class="p">,))</span>
                            <span class="k">for</span> <span class="n">bookid</span><span class="p">,</span> <span class="n">bookname</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                                <span class="n">books</span><span class="p">[</span><span class="n">bookid</span><span class="p">]</span><span class="o">=</span><span class="n">bookname</span>
                            <span class="k">return</span> <span class="n">books</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Adding Books to the Favorite, Hate, Wish list</em></p></li>
</ul>
<hr class="docutils" />
<p>The structure of functions of adding to favorite, wish or hate lists is the same. I implemented the same function for 3 separate lists.Therefore, there is only one code example below. If there is a “UniqueViolation”, existing books are updated as true or false. If there is “InFailedSqlTransactions”, a transaction goes back.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fav_addb</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="n">bookid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO book_list (userid, bookid, fav_b)</span>
<span class="s2">                        VALUES ( </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                        RETURNING id;&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">userid</span><span class="p">,</span><span class="n">bookid</span><span class="p">,</span><span class="s2">&quot;TRUE&quot;</span><span class="p">))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

        <span class="n">a</span><span class="o">=</span><span class="s2">&quot;FALSE&quot;</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; SELECT fav_b FROM book_list</span>
<span class="s2">                        WHERE userid = </span><span class="si">%s</span><span class="s2"> AND bookid = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span> <span class="n">userid</span><span class="p">,</span> <span class="n">bookid</span><span class="p">,))</span>
                <span class="n">check</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">=</span><span class="s2">&quot;TRUE&quot;</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; UPDATE book_list</span>
<span class="s2">                        SET fav_b = </span><span class="si">%s</span><span class="s2"> WHERE userid = </span><span class="si">%s</span><span class="s2"> AND bookid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">bookid</span><span class="p">,))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">InFailedSqlTransactions</span><span class="p">:</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="add-book-page-operations">
<h2>Add Book Page Operations<a class="headerlink" href="#add-book-page-operations" title="Permalink to this headline">¶</a></h2>
<p>This page is accessed via the button at the beginning of the book page.</p>
<p>A form class named BookForm was created in forms.py for adding books to the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">bookForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
        <span class="n">name</span><span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Author&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">year_pub</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span><span class="s1">&#39;Year of Publication&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">tpage</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span><span class="s1">&#39;Total Page&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Publisher&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Language&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">genre</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Genre&#39;</span><span class="p">,</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span><span class="s1">&#39;Add Book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The addbook function has been added to the Book class in the books.py file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">addbook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="n">writer_ids</span><span class="o">=</span><span class="p">{}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">wri_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT id FROM writer WHERE wr_name= (</span><span class="si">%s</span><span class="s2">);&quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">wri_name</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">writer_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">writer_ids</span><span class="p">[</span><span class="n">wri_name</span><span class="p">]</span><span class="o">=</span><span class="n">writer_id</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>


<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">wri_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO writer (wr_name) VALUES (</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                                RETURNING id;&quot;&quot;&quot;</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">wri_name</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">writer_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">writer_ids</span><span class="p">[</span><span class="n">wri_name</span><span class="p">]</span><span class="o">=</span><span class="n">writer_id</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>


<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO books (NAME, WRITERID, PUB_YEAR, T_PAGE, PUBLISHER, LANGUAGE, GENRE, SCORE, VOTE)</span>
<span class="s2">                            VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                    RETURNING id;&quot;&quot;&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">writer_ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_pub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">genre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vote</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">book_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<p>A redirect is provided to the home page if the operation is successful in server.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/addbook&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">bookForm_page</span><span class="p">():</span>
        <span class="n">form</span><span class="o">=</span><span class="n">bookForm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">:</span>
                        <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">writer</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>        <span class="n">year_pub</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">year_pub</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">tpage</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">tpage</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">publisher</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">language</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">language</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">genre</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">genre</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">book</span><span class="o">.</span><span class="n">addbook</span><span class="p">()</span>
                <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{form.name.data}</span><span class="s1"> is created!&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;addbook.html&quot;</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="login-page-operations">
<h2>Login Page Operations<a class="headerlink" href="#login-page-operations" title="Permalink to this headline">¶</a></h2>
<p>“&#64;login_required”  does not provide access to some pages on the website without user input.
If the user input is correct, you will be redirected directly to the homepage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login_page</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
        <span class="n">form</span><span class="o">=</span><span class="n">loginForm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">:</span>
                        <span class="n">user</span> <span class="o">=</span> <span class="n">username_check</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                                <span class="n">login_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">remember</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">remember</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                                <span class="n">next_page</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">next_page</span><span class="p">)</span> <span class="k">if</span> <span class="n">next_page</span> <span class="k">else</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                                <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Login Unsuccessful. Check Username and Password!&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;login.html&quot;</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Flask_wtf was used to get inputs easily. To do this, a forms.py file was created and a class named loginnForm was created.
There is the validations of the information required for the user logining. Email and usename field can not be empty. Username and mail check functions are in userdb.py.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">loginForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span><span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
        <span class="n">remember</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="s1">&#39;Remember Me&#39;</span><span class="p">)</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>These python code snippets check whether the username and mail address entered match the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">username_check</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT id, name, surname, username, mail, gender, birth, password FROM users</span>
<span class="s2">                                WHERE username = (</span><span class="si">%s</span><span class="s2">); &quot;&quot;&quot;</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">username</span><span class="p">,))</span>
            <span class="n">user</span><span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span>  <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">user</span><span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
                <span class="n">mail</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mail_check</span><span class="p">(</span><span class="n">mail</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT id, name, surname, username, mail, gender, birth, password FROM users</span>
<span class="s2">                                WHERE mail = (</span><span class="si">%s</span><span class="s2">); &quot;&quot;&quot;</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">mail</span><span class="p">,))</span>
            <span class="n">user</span><span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span>  <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">user</span><span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
                <span class="n">mail</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
</div>
<div class="section" id="account-operations">
<h2>Account Operations<a class="headerlink" href="#account-operations" title="Permalink to this headline">¶</a></h2>
<p>By implementing this function, the user registered in the web site can update this information with a user name and e-mail address that has not been received before.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">mail</span><span class="p">,</span><span class="nb">id</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;UPDATE users SET mail = (</span><span class="si">%s</span><span class="s2">), username=(</span><span class="si">%s</span><span class="s2">) WHERE id=(</span><span class="si">%s</span><span class="s2">); &quot;&quot;&quot;</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">mail</span><span class="p">,</span><span class="n">username</span><span class="p">,</span><span class="nb">id</span><span class="p">))</span>
</pre></div>
</div>
<p>This is a python function for deleting the user from the database.Since the userid is linked to many tables, the userid and bookid, which are foreign key in some tables, are initially defined as “on delete cascade”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="n">idno</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;DELETE FROM users WHERE id=(</span><span class="si">%s</span><span class="s2">) ;</span>
<span class="s2">                                 &quot;&quot;&quot;</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,(</span><span class="n">idno</span><span class="p">,))</span>
                        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/account&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>if delete button is pressed, “1” value is sent from html form and user is deleted. you will be redirected to the login page. If the user has been updated, you will be redirected to your account page and you will see your updated data. These routing operations take place in the server.py file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">account</span><span class="p">():</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UpdateForm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
                        <span class="n">delete_user</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">logout_user</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login_page&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
                                <span class="n">update_user</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">form</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Updated Account: </span><span class="si">{form.username.data}</span><span class="s1">, </span><span class="si">{form.mail.data}</span><span class="s1">!&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to Update Account to </span><span class="si">{form.username.data}</span><span class="s1">, </span><span class="si">{form.mail.data}</span><span class="s1">!&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;account.html&quot;</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="neslihan.html" class="btn btn-neutral float-left" title="Parts Implemented by Neslihan ÇEKİÇ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ITUCSDB1942

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>